# Image Optimization Guide

## Преглед

DubiRent използва **SixLabors.ImageSharp** библиотека за автоматична оптимизация на снимки при качване. Всички качени снимки се обработват автоматично за по-добра производителност и SEO.

## Какво прави автоматичната оптимизация:

### 1. **Автоматично Resize**

- Максимална ширина: **1920px**
- Максимална височина: **1920px**
- Снимките се преоразмеряват пропорционално при надвишаване на тези размери

### 2. **Компресия**

- **JPEG качество:** 85% (баланс между качество и размер)
- **PNG компресия:** Best Compression
- Автоматично конвертиране на други формати в JPEG

### 3. **Lazy Loading**

- Всички снимки (освен главните) използват `loading="lazy"`
- Главните снимки използват `loading="eager"` с `fetchpriority="high"`

### 4. **Атрибути за производителност**

- `width` и `height` атрибути за предотвратяване на layout shift
- `decoding="async"` за асинхронно декодиране
- Оптимизирани alt текстове за SEO

## Настройки

Настройките са в `AdminController.cs`:

```csharp
private const int MAX_IMAGE_WIDTH = 1920;      // Максимална ширина
private const int MAX_IMAGE_HEIGHT = 1920;     // Максимална височина
private const int IMAGE_QUALITY = 85;          // JPEG качество (0-100)
```

## Използване

### При създаване/редактиране на имот:

1. Качете снимката както обикновено
2. Снимката се оптимизира автоматично:
   - Resize до максимум 1920x1920px
   - Компресира се до 85% качество
   - Запазва се в оптимален формат

### В View-овете:

Снимките автоматично използват:

- Lazy loading (освен главните)
- Width/Height атрибути
- Async decoding
- SEO-friendly alt текстове

## Препоръки

### За най-добра производителност:

1. **Качвайте снимки с размери:**

   - Препоръчително: 1920x1080px или по-малко
   - Максимално: 3840x2160px (ще се намали до 1920px)

2. **Формати:**

   - JPEG - за фотографии (най-малък размер)
   - PNG - за снимки с прозрачност

3. **Размер на файла:**
   - Препоръчително: под 2MB преди оптимизация
   - Максимално: 5MB (лимит в кода)

## Технически детайли

### Библиотека: SixLabors.ImageSharp

- **Версия:** 3.1.5
- **Лиценз:** Apache 2.0
- **Cross-platform:** Да (Windows, Linux, macOS)

### Поддържани формати:

- JPEG
- PNG
- WebP (подготовка за бъдещо използване)

### Производителност:

- Обработката се извършва асинхронно
- Не блокира заявката
- Автоматично rollback при грешка

## WebP Поддръжка ✅

**Имплементирано!** Системата автоматично генерира WebP версии на всички качени снимки.

### Как работи:

1. При качване на снимка се създават **две версии**:

   - **Оригинална версия** (JPEG/PNG) - за fallback
   - **WebP версия** - за модерни браузъри

2. В view-овете се използва `<picture>` таг:
   - Браузърът автоматично избира WebP ако го поддържа
   - Fallback към оригиналния формат за стари браузъри

### Ползи от WebP:

- **30-50% по-малък размер** от JPEG при същото качество
- **25-35% по-малък размер** от PNG
- Подобрена производителност и по-бързо зареждане
- Автоматичен fallback за съвместимост

### Бъдещи подобрения

1. **Thumbnail generation** - Автоматично създаване на thumbnail версии
2. **CDN интеграция** - За разпределение на оптимизираните снимки
3. **Image CDN** - Използване на услуги като Cloudinary или ImageKit
