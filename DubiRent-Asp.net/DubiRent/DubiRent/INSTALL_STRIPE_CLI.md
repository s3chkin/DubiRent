# –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è –Ω–∞ Stripe CLI –∑–∞ Webhooks

## –ë—ä—Ä–∑–æ –†—ä–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è (–ü—Ä–µ–ø–æ—Ä—ä—á–∏—Ç–µ–ª–Ω–æ)

1. **–†–∞–∑—Ä–µ—à–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤–µ:**
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
   (–û—Ç–≥–æ–≤–æ—Ä–∏ "Y" –∫–æ–≥–∞—Ç–æ –ø–æ–ø–∏—Ç–∞)

2. **–°—Ç–∞—Ä—Ç–∏—Ä–∞–π –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏–æ–Ω–Ω–∏—è —Å–∫—Ä–∏–ø—Ç:**
   ```powershell
   cd DubiRent
   .\install-stripe-cli.ps1
   ```

3. **–°–ª–µ–¥ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è, —Å—Ç–∞—Ä—Ç–∏—Ä–∞–π webhook listener:**
   ```powershell
   .\start-stripe-webhook.ps1
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—ä—á–Ω–∞ –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è

#### –°—Ç—ä–ø–∫–∞ 1: –°–≤–∞–ª–∏ Stripe CLI

1. –û—Ç–∏–¥–∏ –Ω–∞: https://github.com/stripe/stripe-cli/releases/latest
2. –°–≤–∞–ª–∏ —Ñ–∞–π–ª–∞: `stripe_X.X.X_windows_x86_64.msi` (–∫—ä–¥–µ—Ç–æ X.X.X –µ –≤–µ—Ä—Å–∏—è—Ç–∞)
3. –°—Ç–∞—Ä—Ç–∏—Ä–∞–π `.msi` —Ñ–∞–π–ª–∞ –∏ —Å–ª–µ–¥–≤–∞–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏—Ç–µ

#### –°—Ç—ä–ø–∫–∞ 2: –ü—Ä–æ–≤–µ—Ä–∏ –ò–Ω—Å—Ç–∞–ª–∞—Ü–∏—è—Ç–∞

–û—Ç–≤–æ—Ä–∏ –Ω–æ–≤ PowerShell —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –Ω–∞–ø–∏—à–∏:

```powershell
stripe --version
```

–ê–∫–æ –≤–∏–¥–∏—à –≤–µ—Ä—Å–∏—è—Ç–∞, –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è—Ç–∞ –µ —É—Å–ø–µ—à–Ω–∞!

#### –°—Ç—ä–ø–∫–∞ 3: Login –≤ Stripe

```powershell
stripe login
```

–¢–æ–≤–∞ —â–µ –æ—Ç–≤–æ—Ä–∏ –±—Ä–∞—É–∑—ä—Ä –∑–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è.

#### –°—Ç—ä–ø–∫–∞ 4: –°—Ç–∞—Ä—Ç–∏—Ä–∞–π Webhook Listener

```powershell
stripe listen --forward-to https://localhost:5001/Payment/Webhook
```

**–ó–∞–±–µ–ª–µ–∂–∫–∞:** –ü—Ä–æ–º–µ–Ω–∏ –ø–æ—Ä—Ç–∞ (`5001`) –∞–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ç–∏ —Ä–∞–±–æ—Ç–∏ –Ω–∞ –¥—Ä—É–≥ –ø–æ—Ä—Ç.

#### –°—Ç—ä–ø–∫–∞ 5: –ö–æ–ø–∏—Ä–∞–π Webhook Secret

–°–ª–µ–¥ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ, CLI —â–µ –ø–æ–∫–∞–∂–µ:

```
> Ready! Your webhook signing secret is whsec_xxxxxxxxxxxxx
```

–ö–æ–ø–∏—Ä–∞–π `whsec_...` secret-–∞ –∏ –≥–æ –¥–æ–±–∞–≤–∏ –≤ `appsettings.json`:

```json
"Stripe": {
  "PublishableKey": "pk_test_...",
  "SecretKey": "sk_test_...",
  "WebhookSecret": "whsec_xxxxxxxxxxxxx"  // ‚Üê –¢–æ–∑–∏ –æ—Ç CLI
}
```

## –ü—Ä–æ–±–ª–µ–º–∏ –∏ –†–µ—à–µ–Ω–∏—è

### "stripe: command not found"

**–†–µ—à–µ–Ω–∏–µ:** –†–µ—Å—Ç–∞—Ä—Ç–∏—Ä–∞–π —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Å–ª–µ–¥ –∏–Ω—Å—Ç–∞–ª–∞—Ü–∏—è. PATH —Å–µ –æ–±–Ω–æ–≤—è–≤–∞ —Å–ª–µ–¥ —Ä–µ—Å—Ç–∞—Ä—Ç.

### "Execution Policy Restriction"

**–†–µ—à–µ–Ω–∏–µ:** 
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### –ü–æ—Ä—Ç—ä—Ç –Ω–µ —Ä–∞–±–æ—Ç–∏

–ü—Ä–æ–≤–µ—Ä–∏ –Ω–∞ –∫–æ–π –ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ç–∏:
- –ü—Ä–æ–≤–µ—Ä–∏ –≤ –∫–æ–Ω–∑–æ–ª–∞—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ: `Now listening on: https://localhost:5001`
- –ò–ª–∏ –ø—Ä–æ–º–µ–Ω–∏ –ø–æ—Ä—Ç–∞ –≤ –∫–æ–º–∞–Ω–¥–∞—Ç–∞:
  ```powershell
  stripe listen --forward-to https://localhost:5000/Payment/Webhook  # HTTP
  ```

### Webhook events –Ω–µ –ø—Ä–∏—Å—Ç–∏–≥–∞—Ç

1. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ —Ç–∏ —Ä–∞–±–æ—Ç–∏
2. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –ø–æ—Ä—Ç—ä—Ç –µ –ø—Ä–∞–≤–∏–ª–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ —Å–∏ –ª–æ–≥–Ω–∞—Ç: `stripe login`
4. –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ webhook secret –µ –ø—Ä–∞–≤–∏–ª–µ–Ω –≤ `appsettings.json`

## –ì–æ—Ç–æ–≤–æ! üéâ

–°–µ–≥–∞ webhook events —â–µ —Å–µ –ø—Ä–µ–Ω–∞—Å–æ—á–≤–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫—ä–º —Ç–≤–æ–µ—Ç–æ –ª–æ–∫–∞–ª–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!

