@* Breadcrumb partial view - auto-generates breadcrumbs based on route, works without model *@
@{
    List<DubiRent.Models.BreadcrumbItem> breadcrumbItems = null;
    
    // Check if breadcrumb items were explicitly passed via ViewData
    if (ViewData["BreadcrumbItems"] is List<DubiRent.Models.BreadcrumbItem> explicitBreadcrumbs && explicitBreadcrumbs != null && explicitBreadcrumbs.Any())
    {
        breadcrumbItems = explicitBreadcrumbs;
    }
    else
    {
        // Auto-generate breadcrumbs based on current route
        var controller = ViewContext.RouteData.Values["Controller"]?.ToString();
        var action = ViewContext.RouteData.Values["Action"]?.ToString();
        breadcrumbItems = new List<DubiRent.Models.BreadcrumbItem>
        {
            new DubiRent.Models.BreadcrumbItem { Text = "Home", Action = "Index", Controller = "Home", IsActive = false }
        };

        if (controller == "Property")
        {
            if (action == "Properties")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Properties", IsActive = true });
            }
            else if (action == "Details")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Properties", Action = "Properties", Controller = "Property" });
                string propertyTitle = ViewBag.PropertyTitle as string ?? ViewData["PropertyTitle"] as string ?? "Property Details";
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = propertyTitle, IsActive = true });
            }
            else if (action == "MyFavourites")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "My Favourites", IsActive = true });
            }
        }
        else if (controller == "Admin")
        {
            if (action == "Index")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", IsActive = true });
            }
            else if (action == "Create")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", Action = "Index", Controller = "Admin" });
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Add Property", IsActive = true });
            }
            else if (action == "Edit")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", Action = "Index", Controller = "Admin" });
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Edit Property", IsActive = true });
            }
            else if (action == "ViewingRequests")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", Action = "Index", Controller = "Admin" });
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Viewing Requests", IsActive = true });
            }
            else if (action == "Users")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", Action = "Index", Controller = "Admin" });
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "User Management", IsActive = true });
            }
            else if (action == "Messages")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Admin Panel", Action = "Index", Controller = "Admin" });
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Messages", IsActive = true });
            }
        }
        else if (controller == "Home")
        {
            if (action == "Contact")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Contact", IsActive = true });
            }
            else if (action == "Privacy")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Privacy Policy", IsActive = true });
            }
        }
        else if (controller == "Payment")
        {
            if (action == "Success")
            {
                breadcrumbItems.Add(new DubiRent.Models.BreadcrumbItem { Text = "Payment Success", IsActive = true });
            }
        }
    }
}

@if (breadcrumbItems != null && breadcrumbItems.Any())
{
    // Structured Data for BreadcrumbList
    var breadcrumbStructuredData = new
    {
        @@context = "https://schema.org",
        @type = "BreadcrumbList",
        itemListElement = breadcrumbItems.Select((item, index) => new
        {
            @@type = "ListItem",
            position = index + 1,
            name = item.Text,
            item = !string.IsNullOrEmpty(item.Action) && !string.IsNullOrEmpty(item.Controller)
                ? ViewContext.HttpContext.Request.Scheme + "://" + ViewContext.HttpContext.Request.Host + Url.Action(item.Action, item.Controller)
                : item.IsActive
                    ? ViewContext.HttpContext.Request.Scheme + "://" + ViewContext.HttpContext.Request.Host + ViewContext.HttpContext.Request.Path
                    : ViewContext.HttpContext.Request.Scheme + "://" + ViewContext.HttpContext.Request.Host
        }).ToList()
    };
    
    <script type="application/ld+json">
        @Html.Raw(System.Text.Json.JsonSerializer.Serialize(breadcrumbStructuredData))
    </script>
    
    <nav aria-label="breadcrumb" class="custom-breadcrumb mb-4">
        <ol class="breadcrumb-list" itemscope itemtype="https://schema.org/BreadcrumbList">
            @for (int i = 0; i < breadcrumbItems.Count; i++)
            {
                var item = breadcrumbItems[i];
                if (item.IsActive || i == breadcrumbItems.Count - 1)
                {
                    <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                        <span class="breadcrumb-text" itemprop="name">@item.Text</span>
                        <meta itemprop="position" content="@(i + 1)" />
                    </li>
                }
                else
                {
                    <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                        @if (!string.IsNullOrEmpty(item.Action) && !string.IsNullOrEmpty(item.Controller))
                        {
                            <a asp-controller="@item.Controller" asp-action="@item.Action" class="breadcrumb-link" itemprop="item">
                                <span itemprop="name">@item.Text</span>
                            </a>
                        }
                        else if (!string.IsNullOrEmpty(item.Url))
                        {
                            <a href="@item.Url" class="breadcrumb-link" itemprop="item">
                                <span itemprop="name">@item.Text</span>
                            </a>
                        }
                        else
                        {
                            <span class="breadcrumb-text" itemprop="name">@item.Text</span>
                        }
                        <meta itemprop="position" content="@(i + 1)" />
                    </li>
                }
                
                @if (i < breadcrumbItems.Count - 1)
                {
                    <li class="breadcrumb-separator">
                        <i class="fas fa-chevron-right"></i>
                    </li>
                }
            }
        </ol>
    </nav>
}
