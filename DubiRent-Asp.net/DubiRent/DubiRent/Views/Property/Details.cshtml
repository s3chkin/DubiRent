@model DubiRent.Data.Models.Property
@using Microsoft.AspNetCore.Identity
@inject SignInManager<DubiRent.Data.Models.AppUser> SignInManager
@inject UserManager<DubiRent.Data.Models.AppUser> UserManager
@{
    ViewData["Title"] = Model?.Title ?? "Property Details";
    var allImages = Model?.Images?.ToList() ?? new List<DubiRent.Data.Models.PropertyImage>();
    var isLoggedIn = SignInManager.IsSignedIn(User);
    var isAdmin = ViewBag.IsAdmin as bool? ?? false;
    var hasPaid = ViewBag.HasPaid as bool? ?? false;
    var hasApprovedRequest = ViewBag.HasApprovedRequest as bool? ?? false;
    var hasPendingRequest = ViewBag.HasPendingRequest as bool? ?? false;
    // Sort images so main image is always first
    var images = allImages.OrderByDescending(img => img.IsMain).ThenBy(img => img.Id).ToList();
    var mainImage = images.FirstOrDefault(img => img.IsMain) ?? images.FirstOrDefault();
    var mainImageUrl = mainImage != null ? (mainImage.ImageUrl.StartsWith("http") ? mainImage.ImageUrl : Context.Request.Scheme + "://" + Context.Request.Host + mainImage.ImageUrl) : "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800";
    
    var description = Model?.Description?.Length > 160 ? Model.Description.Substring(0, 157) + "..." : Model?.Description ?? $"Premium {Model?.Bedrooms} bedroom, {Model?.Bathrooms} bathroom property in {Model?.Location?.Name}, Dubai. Price: ${Model?.PricePerMonth:N0}/month.";
    ViewData["Description"] = description;
    ViewData["Keywords"] = $"property Dubai, {Model?.Location?.Name}, {Model?.Bedrooms} bedroom apartment, rent in Dubai, {Model?.Location?.City}, property rental";
    ViewData["Image"] = mainImageUrl;
    ViewData["Type"] = "product";
    ViewData["CanonicalUrl"] = Context.Request.Scheme + "://" + Context.Request.Host + Url.Action("Details", "Property", new { id = Model?.Id });
    
    // Structured Data for Property (Product schema)
    var structuredData = new
    {
        @@context = "https://schema.org",
        @type = "Product",
        name = Model?.Title,
        description = Model?.Description,
        image = images.Select(img => img.ImageUrl.StartsWith("http") ? img.ImageUrl : Context.Request.Scheme + "://" + Context.Request.Host + img.ImageUrl).ToList(),
        offers = new
        {
            @@type = "Offer",
            price = Model?.PricePerMonth ?? 0,
            priceCurrency = "USD",
            availability = Model?.Status == DubiRent.Data.Models.PropertyStatus.Available ? "https://schema.org/InStock" : "https://schema.org/OutOfStock"
        },
        brand = new
        {
            @@type = "Brand",
            name = "DubiRent"
        },
        aggregateRating = new
        {
            @@type = "AggregateRating",
            ratingValue = "4.8",
            reviewCount = "127"
        }
    };
    
    var propertyStructuredData = new
    {
        @@context = "https://schema.org",
        @type = "RealEstateAgent",
        name = "DubiRent",
        url = Context.Request.Scheme + "://" + Context.Request.Host,
        logo = Context.Request.Scheme + "://" + Context.Request.Host + Url.Content("~/images/site-logo/DubiRent-cut.png")
    };
    
    ViewData["StructuredData"] = "<script type=\"application/ld+json\">" + System.Text.Json.JsonSerializer.Serialize(structuredData) + "</script>" +
                                  "<script type=\"application/ld+json\">" + System.Text.Json.JsonSerializer.Serialize(propertyStructuredData) + "</script>";
}

@section Styles {
    <link rel="stylesheet" href="~/css/property-details.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/property-details.js" asp-append-version="true"></script>
}

<div class="container-fluid property-details-container">
    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show rounded-4 shadow-sm mb-4" role="alert" style="border-left: 4px solid #10b981;">
            <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show rounded-4 shadow-sm mb-4" role="alert" style="border-left: 4px solid #ef4444;">
            <i class="fas fa-exclamation-circle me-2"></i>@TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <!-- Main Content - 60% -->
        <div class="col-lg-7 main-content">
            <partial name="_Breadcrumb" />

            <!-- Property Header -->
            <div class="property-info-card">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h1 class="property-header-title mb-0" style="flex: 1;">@Model?.Title</h1>
                    @if (User.Identity.IsAuthenticated)
                    {
                        <button id="favouriteBtn" class="btn btn-link p-0 border-0 favourite-btn ms-3" style="font-size: 1.2rem; line-height: 1; @(ViewBag.IsFavourite == true ? "color: #fe5658;" : "color: #6b7280;")" data-property-id="@Model?.Id" data-toggle-favourite-url="@Url.Action("ToggleFavourite", "Property")">
                            <i class="@(ViewBag.IsFavourite == true ? "fas" : "far") fa-heart"></i>
                        </button>
                    }
                    @Html.AntiForgeryToken()
                </div>
                <div class="d-flex align-items-center gap-2 flex-wrap mb-2">
                    <span class="property-details-status-badge property-details-status-@Model?.Status.ToString().ToLower()">
                        @Model?.Status
                    </span>
                    @if (Model?.IsActive == true)
                    {
                        <span class="text-success" style="font-size: 0.75rem;">
                            <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i>Active
                        </span>
                    }
                </div>
                <p class="text-muted mb-0 d-flex align-items-center" style="font-size: 0.875rem;">
                    <i class="fas fa-map-marker-alt dubirent-red me-2"></i>
                    <span>@Model?.Location?.Name, @Model?.Address</span>
                </p>
            </div>

            <!-- Image Gallery -->
            <div class="property-image-gallery">
                @{
                    var mainWebpUrl = ImageHelper.GetWebpPath(mainImageUrl);
                    var mainHasWebP = !string.IsNullOrEmpty(mainWebpUrl) && !mainWebpUrl.StartsWith("http") && ImageHelper.WebpExists(mainWebpUrl, ViewContext.HttpContext.RequestServices.GetRequiredService<IWebHostEnvironment>());
                }
                @if (mainHasWebP)
                {
                    <picture>
                        <source srcset="@mainWebpUrl" type="image/webp">
                        <img id="mainImage" 
                             src="@mainImageUrl" 
                             alt="@Model?.Title" 
                             class="main-property-image" 
                             data-image-index="0"
                             loading="eager"
                             fetchpriority="high"
                             width="800"
                             height="600"
                             decoding="async"
                             onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800'" />
                    </picture>
                }
                else
                {
                    <img id="mainImage" 
                         src="@mainImageUrl" 
                         alt="@Model?.Title" 
                         class="main-property-image" 
                         data-image-index="0"
                         loading="eager"
                         fetchpriority="high"
                         width="800"
                         height="600"
                         decoding="async"
                         onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800'" />
                }
                
                @if (images.Any())
                {
                    <div class="thumbnail-images">
                        @{ int imageIndex = 0; }
                        @foreach (var image in images)
                        {
                            var thumbWebpUrl = ImageHelper.GetWebpPath(image.ImageUrl);
                            var thumbHasWebP = !string.IsNullOrEmpty(thumbWebpUrl) && !thumbWebpUrl.StartsWith("http") && ImageHelper.WebpExists(thumbWebpUrl, ViewContext.HttpContext.RequestServices.GetRequiredService<IWebHostEnvironment>());
                            
                            @if (thumbHasWebP)
                            {
                                <picture>
                                    <source srcset="@thumbWebpUrl" type="image/webp">
                                    <img src="@image.ImageUrl" 
                                         alt="@Model?.Title - Image @(imageIndex + 1)" 
                                         class="thumbnail-image @(image.IsMain ? "active" : "")"
                                         data-full-image="@image.ImageUrl"
                                         data-image-index="@imageIndex"
                                         loading="lazy"
                                         width="100"
                                         height="100"
                                         decoding="async"
                                         onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=200'" />
                                </picture>
                            }
                            else
                            {
                                <img src="@image.ImageUrl" 
                                     alt="@Model?.Title - Image @(imageIndex + 1)" 
                                     class="thumbnail-image @(image.IsMain ? "active" : "")"
                                     data-full-image="@image.ImageUrl"
                                     data-image-index="@imageIndex"
                                     loading="lazy"
                                     width="100"
                                     height="100"
                                     decoding="async"
                                     onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=200'" />
                            }
                            imageIndex++;
                        }
                    </div>
                }
            </div>

            <!-- Property Features -->
            <div class="property-info-card">
                <div class="property-features-grid">
                    <div class="property-feature">
                        <div class="property-feature-icon">
                            <i class="fas fa-bed"></i>
                        </div>
                        <div class="property-feature-value">@Model?.Bedrooms</div>
                        <div class="property-feature-label">Bedrooms</div>
                    </div>
                    <div class="property-feature">
                        <div class="property-feature-icon">
                            <i class="fas fa-bath"></i>
                        </div>
                        <div class="property-feature-value">@Model?.Bathrooms</div>
                        <div class="property-feature-label">Bathrooms</div>
                    </div>
                    <div class="property-feature">
                        <div class="property-feature-icon">
                            <i class="fas fa-ruler-combined"></i>
                        </div>
                        <div class="property-feature-value">@Model?.SquareMeters</div>
                        <div class="property-feature-label">m²</div>
                    </div>
                    <div class="property-feature">
                        <div class="property-feature-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="property-feature-value">@((Model?.CreatedAt != null ? (DateTime.Now - Model.CreatedAt).Days : 0))</div>
                        <div class="property-feature-label">Days Listed</div>
                    </div>
                </div>

                <div class="section-divider">
                    <h4 class="fw-bold mb-2" style="font-size: 1.125rem;">Description</h4>
                    <p class="description-text mb-0">@Model?.Description</p>
                </div>
            </div>
        </div>

        <!-- Fixed Sidebar - 40% -->
        <div class="col-lg-5">
            <div class="fixed-sidebar">
                <!-- Viewing Request Card -->
                <div class="sidebar-card">
                    @{
                        var currentUser = isLoggedIn ? await UserManager.GetUserAsync(User) : null;
                        var userEmail = currentUser?.Email ?? "";
                    }
                    
                    @if (ViewBag.IsAdmin == true)
                    {
                        var viewingRequests = ViewBag.ViewingRequestsForProperty as List<DubiRent.Data.Models.ViewingRequest> ?? new List<DubiRent.Data.Models.ViewingRequest>();
                        
                        <h4 class="sidebar-section-title mb-3">Viewing Requests</h4>
                        
                        @if (viewingRequests.Any())
                        {
                            <div style="max-height: 500px; overflow-y: auto;">
                                @foreach (var request in viewingRequests)
                                {
                                    <div class="mb-3 p-3 rounded-4" style="background: #f9fafb; border: 1px solid #e5e7eb;">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <div>
                                                <strong class="d-block mb-1" style="font-size: 0.875rem;">@request.FullName</strong>
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-envelope me-1"></i>@request.Email
                                                </small>
                                                <small class="text-muted d-block">
                                                    <i class="fas fa-phone me-1"></i>@request.PhoneNumber
                                                </small>
                                            </div>
                                            @{
                                                var statusBadgeClass = "";
                                                var statusBgClass = "";
                                                switch (request.Status.ToString())
                                                {
                                                    case "Pending":
                                                        statusBadgeClass = "bg-warning";
                                                        statusBgClass = "#fef3c7";
                                                        break;
                                                    case "Approved":
                                                        statusBadgeClass = "bg-success";
                                                        statusBgClass = "#d1fae5";
                                                        break;
                                                    case "Completed":
                                                        statusBadgeClass = "bg-info";
                                                        statusBgClass = "#dbeafe";
                                                        break;
                                                    case "Cancelled":
                                                        statusBadgeClass = "bg-danger";
                                                        statusBgClass = "#fee2e2";
                                                        break;
                                                }
                                            }
                                            <span class="badge @statusBadgeClass" style="font-size: 0.7rem;">@request.Status</span>
                                        </div>
                                        <div class="mt-2 pt-2" style="border-top: 1px solid #e5e7eb;">
                                            <small class="text-muted d-block mb-1">
                                                <i class="fas fa-calendar me-1"></i>
                                                Preferred: @request.PreferredDate.ToString("MMM dd, yyyy")
                                            </small>
                                            <small class="text-muted d-block mb-1">
                                                <i class="fas fa-clock me-1"></i>
                                                Time: @{
                                                    var timeHour = request.PreferredTime.Hours;
                                                    var timeMinute = request.PreferredTime.Minutes;
                                                    var period = timeHour >= 12 ? "PM" : "AM";
                                                    var displayHour = timeHour > 12 ? timeHour - 12 : (timeHour == 0 ? 12 : timeHour);
                                                }
                                                @displayHour.ToString("00"):@timeMinute.ToString("00") @period
                                            </small>
                                            <small class="text-muted d-block">
                                                <i class="fas fa-clock me-1"></i>
                                                Requested: @request.CreatedAt.ToString("MMM dd, yyyy")
                                            </small>
                                        </div>
                                    </div>
                                }
                            </div>
                            <div class="mt-3 text-center">
                                <a asp-controller="Admin" asp-action="ViewingRequests" class="btn btn-outline-primary btn-sm w-100" style="border-radius: 10px;">
                                    <i class="fas fa-list me-2"></i>Manage All Requests
                                </a>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info rounded-4 mb-0" style="border-left: 4px solid #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-info-circle me-2 mt-1" style="color: #3b82f6;"></i>
                                    <div style="flex: 1;">
                                        <strong class="d-block mb-1">No viewing requests yet</strong>
                                        <small class="d-block text-muted">No one has requested a viewing for this property.</small>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <h4 class="sidebar-section-title mb-2">Schedule a Viewing</h4>
                        
                        @if (!isLoggedIn)
                        {
                        <div class="alert alert-warning rounded-4" style="border-left: 4px solid #f59e0b; background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-exclamation-triangle me-2 mt-1" style="color: #f59e0b;"></i>
                                <div style="flex: 1;">
                                    <strong class="d-block mb-1">Please log in to request a viewing</strong>
                                    <small class="d-block text-muted mb-2">You need to be logged in to schedule a property viewing.</small>
                                    <a asp-area="Identity" 
                                       asp-page="/Account/Login" 
                                       asp-route-returnUrl="@Url.Action("Details", "Property", new { id = Model?.Id })"
                                       class="login-btn-modern w-100 d-flex align-items-center justify-content-center gap-2"
                                       style="background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%); 
                                              border: 2px solid var(--primary-color); 
                                              color: var(--primary-color); 
                                              border-radius: 10px; 
                                              padding: 0.625rem 1rem; 
                                              font-weight: 600; 
                                              font-size: 0.8125rem;
                                              transition: all 0.3s ease;
                                              text-decoration: none;">
                                        <i class="fas fa-sign-in-alt"></i>
                                        <span>Login to Your Account</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                        }
                        else if (ViewBag.HasExistingRequest == true && ViewBag.ExistingRequest != null)
                        {
                        var existingRequest = ViewBag.ExistingRequest as DubiRent.Data.Models.ViewingRequest;
                        <div class="alert alert-info rounded-4" style="border-left: 4px solid #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">
                            <div class="d-flex align-items-start">
                                <i class="fas fa-info-circle me-2 mt-1" style="color: #3b82f6;"></i>
                                <div style="flex: 1;">
                                    <strong class="d-block mb-2">You have already requested a viewing for this property</strong>
                                    <div class="mb-2">
                                        <span class="badge bg-primary">@existingRequest.Status</span>
                                    </div>
                                    <small class="d-block text-muted mb-1">
                                        <i class="fas fa-calendar me-1"></i>
                                        Requested on: @existingRequest.CreatedAt.ToString("MMM dd, yyyy")
                                    </small>
                                    @if (existingRequest.Status == DubiRent.Data.Models.ViewingRequestStatus.Pending)
                                    {
                                        <small class="d-block text-muted">
                                            <i class="fas fa-clock me-1"></i>
                                            Your request is pending approval
                                        </small>
                                    }
                                </div>
                            </div>
                        </div>
                        }
                        else
                        {
                            <form asp-action="RequestViewing" method="post" id="viewingForm" class="property-details-form">
                            @Html.AntiForgeryToken()
                            <input type="hidden" asp-for="Id" name="PropertyId" />
                            
                            <div class="mb-2">
                                <label class="form-label">
                                    <i class="fas fa-user dubirent-red me-2"></i>Full Name
                                </label>
                                <input type="text" 
                                       class="form-control" 
                                       name="FullName" 
                                       placeholder="Enter your full name"
                                       value="@(isLoggedIn ? currentUser?.UserName ?? "" : "")"
                                       required />
                            </div>

                            <div class="mb-2">
                                <label class="form-label">
                                    <i class="fas fa-phone dubirent-red me-2"></i>Phone Number
                                </label>
                                <input type="tel" 
                                       class="form-control" 
                                       name="PhoneNumber" 
                                       placeholder="+971 50 123 4567"
                                       pattern="[+]?[0-9\s-]{8,20}"
                                       required />
                                <small class="text-muted" style="font-size: 0.65rem;">Include country code</small>
                            </div>

                            <div class="mb-2">
                                <label class="form-label">
                                    <i class="fas fa-calendar-alt dubirent-red me-2"></i>Preferred Date
                                </label>
                                <input type="date" 
                                       class="form-control" 
                                       name="PreferredDate" 
                                       min="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")"
                                       value="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" 
                                       required />
                                <small class="text-muted" style="font-size: 0.65rem;">Select a future date</small>
                            </div>

                            <div class="mb-2">
                                <label class="form-label">
                                    <i class="fas fa-clock dubirent-red me-2"></i>Preferred Time
                                </label>
                                <select class="form-select" name="PreferredTime" required>
                                    <option value="09:00:00">9:00 AM</option>
                                    <option value="10:00:00">10:00 AM</option>
                                    <option value="11:00:00">11:00 AM</option>
                                    <option value="12:00:00">12:00 PM</option>
                                    <option value="13:00:00">1:00 PM</option>
                                    <option value="14:00:00">2:00 PM</option>
                                    <option value="15:00:00">3:00 PM</option>
                                    <option value="16:00:00">4:00 PM</option>
                                    <option value="17:00:00">5:00 PM</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-calendar-check me-2"></i><span class="btn-text">Request Viewing</span>
                            </button>
                            <p class="text-muted small text-center mt-2 mb-0" style="font-size: 0.7rem;">
                                <i class="fas fa-info-circle me-1"></i>We'll confirm your viewing time shortly
                            </p>
                        </form>
                        }
                    }

                    <!-- Payment Section in Right Container -->
                    <div class="sidebar-card mt-3">
                        <h4 class="sidebar-section-title mb-3">Payment</h4>
                        @using DubiRent.Helpers
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <div class="price-display" style="font-size: 1.5rem; margin-bottom: 0.25rem; font-weight: 700; color: #1f2937;">
                                    $@Model?.PricePerMonth.ToString("N0")
                                </div>
                                <span class="price-unit" style="font-size: 0.75rem; color: #6b7280;">per month</span>
                            </div>
                        </div>
                        @if (hasPaid)
                        {
                            <div class="alert alert-success mb-0" style="border-radius: 10px; background: #d1fae5; border: 1px solid #10b981; color: #065f46;">
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>Payment Completed</strong>
                                <p class="mb-0 mt-1 small">You have successfully paid for this property. Our team will contact you soon.</p>
                            </div>
                        }
                        else if (isLoggedIn && !isAdmin && hasApprovedRequest)
                        {
                            <a asp-controller="Payment" asp-action="CreatePayment" asp-route-propertyId="@Model?.Id" class="stripe-btn text-decoration-none w-100 d-flex align-items-center justify-content-center">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M13.976 9.15c-2.172-.806-3.356-1.426-3.356-2.409 0-.831.683-1.305 1.901-1.305 2.227 0 4.515.858 6.09 1.631l.89-5.494C18.252.975 15.697 0 12.165 0 9.667 0 7.589.654 6.104 1.872 4.56 3.147 3.757 4.992 3.757 7.218c0 4.039 2.467 5.76 6.476 7.219 2.585.92 3.445 1.574 3.445 2.583 0 .98-.84 1.545-2.354 1.545-1.875 0-4.965-.921-6.99-2.109l-.9 5.555C5.175 22.99 8.385 24 11.714 24c2.641 0 4.843-.624 6.328-1.813 1.664-1.305 2.525-3.236 2.525-5.732 0-4.128-2.524-5.851-6.594-7.305h.003z"/>
                                </svg>
                                <span>Pay with Stripe</span>
                            </a>
                        }
                        else if (isLoggedIn && !isAdmin && !hasApprovedRequest && hasPendingRequest)
                        {
                            <div class="alert alert-info mb-0" style="border-radius: 10px; background: #eff6ff; border: 1px solid #3b82f6; color: #1e40af;">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Waiting for Approval</strong>
                                <p class="mb-0 mt-1 small">Your viewing request is pending approval. Once approved, you'll be able to proceed with payment.</p>
                            </div>
                        }
                        else if (isLoggedIn && !isAdmin && !hasApprovedRequest && !hasPendingRequest)
                        {
                            <div class="alert alert-warning mb-0" style="border-radius: 10px; background: #fff7ed; border: 1px solid #f59e0b; color: #92400e;">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Request Viewing First</strong>
                                <p class="mb-0 mt-1 small">Please request a viewing first. After approval, you'll be able to proceed with payment.</p>
                            </div>
                        }
                        else if (isLoggedIn && isAdmin)
                        {
                            <div class="alert alert-secondary mb-0" style="border-radius: 10px; background: #f3f4f6; border: 1px solid #9ca3af; color: #374151;">
                                <i class="fas fa-shield-alt me-2"></i>
                                <strong>Admin Account</strong>
                                <p class="mb-0 mt-1 small">Payment is not available for administrator accounts.</p>
                            </div>
                        }
                        else
                        {
                            <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@Url.Action("Details", "Property", new { id = Model?.Id })" class="stripe-btn text-decoration-none w-100 d-flex align-items-center justify-content-center" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);">
                                <i class="fas fa-lock me-2"></i>
                                <span>Login to Pay</span>
                            </a>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fullscreen Image Modal -->
<div id="fullscreenModal" class="fullscreen-modal">
    <span class="fullscreen-close" onclick="closeFullscreen()">&times;</span>
    <button class="fullscreen-nav prev" onclick="changeFullscreenImage(-1)" id="prevBtn">
        <i class="fas fa-chevron-left"></i>
    </button>
    <button class="fullscreen-nav next" onclick="changeFullscreenImage(1)" id="nextBtn">
        <i class="fas fa-chevron-right"></i>
    </button>
    <div class="fullscreen-modal-content">
        <img id="fullscreenImage" class="fullscreen-image" src="" alt="Fullscreen Image" />
    </div>
    <div class="fullscreen-counter" id="imageCounter">    </div>
</div>
