@model IEnumerable<DubiRent.Data.Models.Property>
@{
    ViewData["Title"] = "Admin Panel";
    var allProperties = ViewBag.AllProperties as IEnumerable<DubiRent.Data.Models.Property> ?? Model;
    var currentFilter = ViewBag.CurrentFilter as string;
}

<partial name="_Breadcrumb" />

<style>
    .admin-card {
        border-radius: 20px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }
    
    .admin-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(254, 86, 88, 0.1),
                    0 10px 10px -5px rgba(254, 86, 88, 0.04);
    }
    
    .property-image {
        height: 220px;
        object-fit: cover;
        width: 100%;
        transition: transform 0.3s ease;
    }
    
    .admin-card:hover .property-image {
        transform: scale(1.05);
    }
    
    .status-badge {
        padding: 0.375rem 0.875rem;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-available {
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
        border: 1px solid rgba(5, 95, 70, 0.2);
    }
    
    .status-rented {
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        color: #991b1b;
        border: 1px solid rgba(153, 27, 27, 0.2);
    }
    
    .status-archived {
        background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
        color: #374151;
        border: 1px solid rgba(55, 65, 81, 0.2);
    }
    
    .admin-header {
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-radius: 10px;
    }
    
    .stats-card {
        background: white;
        border-radius: 12px;
        padding: 0.875rem 1rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        cursor: pointer;
        text-decoration: none;
        color: inherit;
        display: block;
    }
    
    .stats-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        text-decoration: none;
        color: inherit;
    }

    .stats-card.active {
        border: 2px solid var(--primary-color);
        box-shadow: 0 4px 12px rgba(254, 86, 88, 0.2);
        background: linear-gradient(135deg, #ffe5e6 0%, #ffffff 100%);
    }

    .stats-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 1rem;
    }

    .stats-value {
        font-size: 1.125rem;
        font-weight: 700;
        margin: 0.25rem 0;
        line-height: 1.2;
    }

    .stats-label {
        font-size: 0.75rem;
        color: #6b7280;
        margin: 0;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .empty-state {
        background: linear-gradient(135deg, #ffe5e6 0%, #ffffff 100%);
        border: 2px dashed var(--primary-color);
        border-radius: 20px;
    }

    /* Admin Button Hover Effects */
    .admin-btn-edit {
        transition: all 0.3s ease;
        background-color: transparent !important;
        color: var(--primary-color) !important;
    }

    .admin-btn-edit:hover,
    .admin-btn-edit:focus,
    .admin-btn-edit:active {
        background-color: var(--primary-color) !important;
        color: white !important;
        border-color: var(--primary-color) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(254, 86, 88, 0.3);
    }

    .admin-btn-edit:hover i,
    .admin-btn-edit:focus i,
    .admin-btn-edit:active i {
        color: white !important;
    }

    .admin-btn-delete {
        transition: all 0.3s ease;
        background-color: transparent !important;
        color: #dc2626 !important;
    }

    .admin-btn-delete:hover,
    .admin-btn-delete:focus,
    .admin-btn-delete:active {
        background-color: #dc2626 !important;
        color: white !important;
        border-color: #dc2626 !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    .admin-btn-delete:hover i,
    .admin-btn-delete:focus i,
    .admin-btn-delete:active i {
        color: white !important;
    }

    /* Viewing Requests Button Hover Effect */
    .admin-btn-viewing-requests {
        transition: all 0.3s ease;
        background-color: transparent !important;
    }

    .admin-btn-viewing-requests:hover,
    .admin-btn-viewing-requests:focus,
    .admin-btn-viewing-requests:active {
        background-color: var(--primary-color) !important;
        color: white !important;
        border-color: var(--primary-color) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(254, 86, 88, 0.3);
    }

    .admin-btn-viewing-requests:hover i,
    .admin-btn-viewing-requests:focus i,
    .admin-btn-viewing-requests:active i {
        color: white !important;
    }
</style>

<div class="container py-4">
    <!-- Header Section -->
    <div class="admin-header mb-4">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h1 class="display-5 fw-bold mb-2">
                        <span class="dubirent-red">Admin</span> Panel
                    </h1>
                    <p class="text-muted mb-0">Manage and monitor your properties</p>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <a asp-action="ViewingRequests" class="btn btn-outline-primary d-flex align-items-center gap-2 px-4 py-2 admin-btn-viewing-requests" style="border-radius: 10px; font-weight: 600; border-color: var(--primary-color); color: var(--primary-color);">
                        <i class="fas fa-calendar-check"></i>
                        <span>Viewing Requests</span>
                    </a>
                    <a asp-action="Create" class="btn btn-primary d-flex align-items-center gap-2 px-4 py-2" style="border: none; border-radius: 10px; background: var(--primary-color); font-weight: 600;">
                        <i class="fas fa-plus"></i>
                        <span>Add New Property</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show d-flex align-items-center mb-4" role="alert" style="border-radius: 10px; border: none; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);">
            <i class="fas fa-check-circle me-2 fs-5"></i>
            <span>@TempData["Success"]</span>
            <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Statistics Cards / Filter Buttons -->
    @if (allProperties != null)
    {
        <div class="row g-2 mb-3">
            <div class="col-md-3">
                <a asp-action="Admin" asp-route-statusFilter="" class="stats-card d-flex align-items-center gap-3 @(string.IsNullOrEmpty(currentFilter) ? "active" : "")">
                    <div class="stats-icon" style="background: linear-gradient(135deg, #ffe5e6 0%, #fff5f5 100%); color: var(--primary-color);">
                        <i class="fas fa-home"></i>
                    </div>
                    <div>
                        <div class="stats-value dubirent-red">@allProperties.Count()</div>
                        <p class="stats-label mb-0">Total Properties</p>
                    </div>
                </a>
            </div>
            <div class="col-md-3">
                <a asp-action="Admin" asp-route-statusFilter="Available" class="stats-card d-flex align-items-center gap-3 @(currentFilter == "Available" ? "active" : "")">
                    <div class="stats-icon" style="background: linear-gradient(135deg, #d1fae5 0%, #ecfdf5 100%); color: #059669;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div>
                        <div class="stats-value" style="color: #059669;">@allProperties.Count(p => p.Status == DubiRent.Data.Models.PropertyStatus.Available)</div>
                        <p class="stats-label mb-0">Available</p>
                    </div>
                </a>
            </div>
            <div class="col-md-3">
                <a asp-action="Admin" asp-route-statusFilter="Rented" class="stats-card d-flex align-items-center gap-3 @(currentFilter == "Rented" ? "active" : "")">
                    <div class="stats-icon" style="background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%); color: #dc2626;">
                        <i class="fas fa-key"></i>
                    </div>
                    <div>
                        <div class="stats-value" style="color: #dc2626;">@allProperties.Count(p => p.Status == DubiRent.Data.Models.PropertyStatus.Rented)</div>
                        <p class="stats-label mb-0">Rented</p>
                    </div>
                </a>
            </div>
            <div class="col-md-3">
                <a asp-action="Admin" asp-route-statusFilter="Archived" class="stats-card d-flex align-items-center gap-3 @(currentFilter == "Archived" ? "active" : "")">
                    <div class="stats-icon" style="background: linear-gradient(135deg, #e5e7eb 0%, #f3f4f6 100%); color: #6b7280;">
                        <i class="fas fa-archive"></i>
                    </div>
                    <div>
                        <div class="stats-value" style="color: #6b7280;">@allProperties.Count(p => p.Status == DubiRent.Data.Models.PropertyStatus.Archived)</div>
                        <p class="stats-label mb-0">Archived</p>
                    </div>
                </a>
            </div>
        </div>
    }

    <!-- Properties List -->
    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var property in Model)
            {
                var mainImage = property.Images?.FirstOrDefault(img => img.IsMain) ?? property.Images?.FirstOrDefault();
                var imageUrl = mainImage != null ? mainImage.ImageUrl : "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=600";
                // Add cache busting parameter for newly uploaded images
                if (mainImage != null && !imageUrl.Contains("?"))
                {
                    imageUrl = $"{imageUrl}?v={mainImage.CreatedAt:yyyyMMddHHmmss}";
                }

                <div class="col-md-4">
                    <div class="card border-0 overflow-hidden modern-card h-100 bg-white" style="border-radius: 20px; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);">
                        <div class="position-relative">
                            <a asp-action="Details" asp-route-id="@property.Id" class="text-decoration-none">
                            <img src="@imageUrl" onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=600'"
                                 alt="@property.Title"
                                 @* class="property-image" *@
                                 class="card-img-top img-hover" style="height: 220px; object-fit: cover;" />
                            </a>

                            <!-- Verified Badge -->
                            <div class="position-absolute top-0 start-0 m-3 bg-white rounded-pill px-3 py-1 small fw-semibold" style="border: 1px solid rgba(254, 86, 88, 0.3); color: var(--primary-color);">
                                <i class="fas fa-check-circle me-1"></i>@property.Status.ToString().ToLower()
                            </div>

                            <!-- Premium Badge -->
                            <div class="position-absolute top-0 end-0 m-3 rounded-pill px-3 py-1 small fw-semibold text-white" style="background-color: #3b82f6;">
                                <i class="fas fa-crown me-1"></i>Premium
                            </div>
                        </div>

                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title fw-bold mb-0" style="flex: 1;">@property.Title</h5>
                                <button class="btn btn-link p-0 border-0 text-muted" style="font-size: 1.2rem; line-height: 1;">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>

                            <p class="text-muted small mb-2 d-flex align-items-center">
                                <i class="fas fa-map-marker-alt me-2"></i>@property.Location?.Name
                            </p>

                            <p class="dubirent-red fs-5 fw-bold mb-3">
                                $@property.PricePerMonth.ToString("N0") <span class="text-muted small fw-normal">/month</span>
                            </p>

                            <div class="d-flex justify-content-between align-items-center mb-3 pb-3" style="border-top: 1px solid #f3f4f6; border-bottom: 1px solid #f3f4f6; padding-top: 0.75rem;">
                                <span class="text-muted small d-flex align-items-center">
                                    <i class="fas fa-ruler-combined me-2 dubirent-red"></i>@property.SquareMeters m²
                                </span>
                                <span class="text-muted small d-flex align-items-center">
                                    <i class="fas fa-bed me-2 dubirent-red"></i>@property.Bedrooms Bedrooms
                                </span>
                                <span class="text-muted small d-flex align-items-center">
                                    <i class="fas fa-bath me-2 dubirent-red"></i>@property.Bathrooms Bathrooms
                                </span>
                            </div>

                            <div class="d-flex justify-content-between align-items-center gap-2 mb-3">
                                <p class="text-muted small mb-0 d-flex align-items-center">
                                    <i class="far fa-calendar me-2"></i>@property.CreatedAt.ToString("MMM dd, yyyy")
                                </p>
                                <a asp-action="Details" asp-route-id="@property.Id" class="btn btn-primary rounded-4 px-3 py-2 text-white small text-decoration-none" style="border: none; white-space: nowrap;">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </a>
                            </div>
                            
                            <div class="pt-3" style="border-top: 1px solid #f3f4f6;">
                                <div class="d-flex gap-2">
                                    <a asp-action="Edit" asp-route-id="@property.Id" class="btn btn-outline-primary flex-fill rounded-4 px-3 py-2 text-primary small text-decoration-none admin-btn-edit" style="border-color: var(--primary-color);">
                                        <i class="fas fa-edit me-1"></i>Edit
                                    </a>
                                    <button type="button" class="btn btn-outline-danger flex-fill rounded-4 px-3 py-2 text-danger small admin-btn-delete" style="border-color: #dc2626;" data-bs-toggle="modal" data-bs-target="#deleteModal" data-property-id="@property.Id" data-property-title="@property.Title">
                                        <i class="fas fa-trash me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


               @*  <div class="col-md-6 col-lg-4">
                    <div class="card admin-card h-100 border-0 shadow-md bg-white">
                        <!-- Property Image -->
                        <div class="position-relative overflow-hidden">
                            <img src="@imageUrl"
                                 alt="@property.Title"
                                 class="property-image"
                                 onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=600'" />
                            
                            <!-- Status Badge -->
                            <div class="position-absolute top-0 start-0 m-3">
                                <span class="status-badge status-@property.Status.ToString().ToLower()">
                                    @property.Status
                                </span>
                            </div>
                            
                            <!-- Active Badge -->
                            @if (property.IsActive)
                            {
                                <div class="position-absolute top-0 end-0 m-3 bg-white rounded-pill px-3 py-1 small fw-semibold" style="border: 1px solid rgba(254, 86, 88, 0.3); color: var(--primary-color);">
                                    <i class="fas fa-check-circle me-1"></i>Active
                                </div>
                            }
                        </div>
                        
                        <!-- Card Body -->
                        <div class="card-body p-4">
                            <!-- Title and Location -->
                            <h5 class="card-title fw-bold mb-2" style="font-size: 1.1rem; line-height: 1.3;">
                                @property.Title
                            </h5>
                            
                            <div class="mb-3 d-flex align-items-center">
                                <i class="fas fa-map-marker-alt dubirent-red me-2"></i>
                                <span class="small text-muted">@property.Location?.Name</span>
                            </div>
                            
                            <!-- Description -->
                            <p class="text-muted small mb-3" style="font-size: 0.875rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; min-height: 2.5rem; white-space: pre-wrap; word-wrap: break-word;">
                                @property.Description
                            </p>
                            
                            <!-- Property Features -->
                            <div class="row g-2 mb-3">
                                <div class="col-4">
                                    <div class="text-center p-2 rounded" style="background: linear-gradient(135deg, #ffe5e6 0%, #ffffff 100%); border: 1px solid rgba(254, 86, 88, 0.2);">
                                        <div class="dubirent-red mb-1">
                                            <i class="fas fa-bed"></i>
                                        </div>
                                        <div class="fw-semibold small">@property.Bedrooms</div>
                                        <div class="text-muted" style="font-size: 0.7rem;">Beds</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center p-2 rounded" style="background: linear-gradient(135deg, #ffe5e6 0%, #ffffff 100%); border: 1px solid rgba(254, 86, 88, 0.2);">
                                        <div class="dubirent-red mb-1">
                                            <i class="fas fa-bath"></i>
                                        </div>
                                        <div class="fw-semibold small">@property.Bathrooms</div>
                                        <div class="text-muted" style="font-size: 0.7rem;">Baths</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center p-2 rounded" style="background: linear-gradient(135deg, #ffe5e6 0%, #ffffff 100%); border: 1px solid rgba(254, 86, 88, 0.2);">
                                        <div class="dubirent-red mb-1">
                                            <i class="fas fa-ruler-combined"></i>
                                        </div>
                                        <div class="fw-semibold small">@property.SquareMeters</div>
                                        <div class="text-muted" style="font-size: 0.7rem;">m²</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Price -->
                            <div class="mb-3 pb-3 border-bottom">
                                <div class="d-flex align-items-baseline gap-2">
                                    <span class="fw-bold fs-4 dubirent-red">$@property.PricePerMonth.ToString("N0")</span>
                                    <span class="text-muted small">/month</span>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="d-flex gap-2">
                                <a href="#" class="btn btn-outline-primary flex-fill py-2" style="border-radius: 10px; border-color: var(--primary-color); color: var(--primary-color); font-weight: 600;">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </a>
                                <a href="#" class="btn btn-outline-danger flex-fill py-2" style="border-radius: 10px; font-weight: 600;">
                                    <i class="fas fa-trash me-1"></i>Delete
                                </a>
                            </div>
                        </div>
                        
                        <!-- Card Footer -->
                        <div class="card-footer bg-transparent border-top px-4 py-2">
                            <small class="text-muted d-flex align-items-center">
                                <i class="fas fa-calendar-alt me-2 dubirent-red"></i>
                                <span>Created @property.CreatedAt.ToString("MMM dd, yyyy")</span>
                            </small>
                        </div>
                    </div>
                </div> *@
            }
        </div>
    }
    else
    {
        <div class="card empty-state border-0 shadow-sm p-5 text-center">
            <div class="mb-4">
                <div class="dubirent-bg-red d-inline-flex align-items-center justify-content-center rounded-circle mb-3" style="width: 80px; height: 80px;">
                    <i class="fas fa-home fa-3x text-white"></i>
                </div>
            </div>
            <h4 class="fw-bold mb-2">No Properties Yet</h4>
            <p class="text-muted mb-4">Start by adding your first property to the system and begin managing your listings.</p>
            <a asp-action="Create" class="btn btn-primary px-5 py-3" style="border: none; border-radius: 10px; background: var(--primary-color); font-weight: 600;">
                <i class="fas fa-plus me-2"></i>Add Your First Property
            </a>
        </div>
    }
    
    <!-- Pagination -->
    @await Html.PartialAsync("_Pagination")

</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 20px; border: none; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
            <div class="modal-header border-0 pb-0" style="padding: 2rem 2rem 1rem;">
                <div class="modal-icon-wrapper d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 80px; height: 80px; background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-radius: 50%;">
                    <i class="fas fa-exclamation-triangle text-danger" style="font-size: 2.5rem;"></i>
                </div>
            </div>
            <div class="modal-body text-center px-4 pb-0" style="padding: 0 2rem 1.5rem;">
                <h5 class="modal-title fw-bold mb-3" id="deleteModalLabel" style="font-size: 1.5rem; color: #1f2937;">
                    Delete Property?
                </h5>
                <p class="text-muted mb-4" style="font-size: 0.9375rem; line-height: 1.6;">
                    Are you sure you want to delete <strong class="text-dark" id="propertyTitleText"></strong>?
                </p>
                <div class="alert alert-warning d-flex align-items-start mb-4" style="border-radius: 10px; background: #fff7ed; border: 1px solid #fed7aa; color: #9a3412;">
                    <i class="fas fa-info-circle me-2 mt-1"></i>
                    <div class="text-start" style="font-size: 0.875rem;">
                        <strong>Warning:</strong> This action cannot be undone. The property and all associated images will be permanently deleted.
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0 justify-content-center gap-3" style="padding: 0 2rem 2rem;">
                <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal" style="border-radius: 10px; border: 1px solid #e5e7eb; font-weight: 600;">
                    <i class="fas fa-times me-2"></i>Cancel
                </button>
                <form id="deleteForm" method="post" class="d-inline">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-danger px-4 py-2" style="border-radius: 10px; background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); border: none; font-weight: 600; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);">
                        <i class="fas fa-trash me-2"></i><span class="btn-text">Delete Property</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
    }

    .modal-content {
        animation: fadeInUp 0.3s ease-out;
    }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(220, 38, 38, 0.4) !important;
    }

    .btn-light:hover {
        background-color: #f3f4f6;
        border-color: #d1d5db;
    }

</style>

@section Scripts {
    <script>
        var deleteModal = document.getElementById('deleteModal');
        if (deleteModal) {
            deleteModal.addEventListener('show.bs.modal', function (event) {
                // Button that triggered the modal
                var button = event.relatedTarget;
                
                // Extract info from data-bs-* attributes
                var propertyId = button.getAttribute('data-property-id');
                var propertyTitle = button.getAttribute('data-property-title');
                
                // Update the modal's content
                var modalTitle = deleteModal.querySelector('#propertyTitleText');
                var deleteForm = deleteModal.querySelector('#deleteForm');
                
                modalTitle.textContent = '"' + propertyTitle + '"';
                deleteForm.action = '@Url.Action("Delete", "Property")/' + propertyId;
            });
        }
    </script>
}
