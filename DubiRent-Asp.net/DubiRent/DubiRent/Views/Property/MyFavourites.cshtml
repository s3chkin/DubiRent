@model IEnumerable<DubiRent.Data.Models.Property>
@{
    ViewData["Title"] = "My Favourites";
    ViewData["Description"] = "View your favorite properties in Dubai. Save properties you're interested in and access them anytime.";
    ViewData["Robots"] = "noindex, follow";
}

@section Styles {
    <link rel="stylesheet" href="~/css/my-favourites.css" asp-append-version="true" />
}

<partial name="_Breadcrumb" />

<div class="my-favourites-page">
<div class="container py-4">
    <!-- Page Header -->
    <div class="page-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            <div>
                <h1 class="fw-bold mb-2" style="font-size: 2rem;">
                    <i class="fas fa-heart me-2"></i>My Favourites
                </h1>
                <p class="mb-0 opacity-90">Properties you've saved to your favourites list</p>
            </div>
            <div class="text-end">
                <div class="d-flex align-items-baseline gap-2">
                    <h2 class="fw-bold mb-0" style="font-size: 2.5rem;">@(ViewBag.TotalCount ?? 0)</h2>
                    <span class="opacity-90" style="font-size: 1rem;">Saved</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Properties Grid -->
    @if (Model != null && Model.Any())
    {
        <div class="row g-4">
            @foreach (var property in Model)
            {
                var mainImage = property.Images?.FirstOrDefault(img => img.IsMain) ?? property.Images?.FirstOrDefault();
                var imageUrl = mainImage != null ? $"{mainImage.ImageUrl}?t={DateTime.Now.Ticks}" : "https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400";
                var statusClass = property.Status.ToString().ToLower() == "available" ? "status-available" : "status-rented";

                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="property-card">
                        <div class="property-image-wrapper">
                            <a asp-action="Details" asp-route-id="@property.Id" style="display: block; height: 100%;">
                                @{
                                    var favWebpUrl = ImageHelper.GetWebpPath(imageUrl);
                                    var favHasWebP = !string.IsNullOrEmpty(favWebpUrl) && !favWebpUrl.StartsWith("http") && ImageHelper.WebpExists(favWebpUrl, ViewContext.HttpContext.RequestServices.GetRequiredService<IWebHostEnvironment>());
                                }
                                @if (favHasWebP)
                                {
                                    <picture>
                                        <source srcset="@favWebpUrl" type="image/webp">
                                        <img src="@imageUrl" 
                                             alt="@property.Title" 
                                             class="property-image" 
                                             loading="lazy"
                                             width="400"
                                             height="300"
                                             decoding="async"
                                             onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400'" />
                                    </picture>
                                }
                                else
                                {
                                    <img src="@imageUrl" 
                                         alt="@property.Title" 
                                         class="property-image" 
                                         loading="lazy"
                                         width="400"
                                         height="300"
                                         decoding="async"
                                         onerror="this.src='https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=400'" />
                                }
                            </a>
                            <div class="favourite-badge">
                                <i class="fas fa-heart"></i>
                            </div>
                            <span class="status-badge @statusClass" style="position: absolute; top: 12px; left: 12px;">
                                <span class="d-none d-sm-inline">@property.Status</span><span class="d-sm-none">@property.Status.ToString().Substring(0, 1)</span>
                            </span>
                        </div>
                        <div class="property-card-body">
                            <h3 class="property-title">
                                <a asp-action="Details" asp-route-id="@property.Id" class="text-decoration-none text-dark">
                                    @property.Title
                                </a>
                            </h3>
                            <div class="property-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;">@property.Location?.Name, @property.Address</span>
                            </div>
                            <div class="property-features">
                                <div class="property-feature">
                                    <i class="fas fa-bed"></i>
                                    <span class="d-none d-sm-inline">@property.Bedrooms Beds</span><span class="d-sm-none">@property.Bedrooms</span>
                                </div>
                                <div class="property-feature">
                                    <i class="fas fa-bath"></i>
                                    <span class="d-none d-sm-inline">@property.Bathrooms Baths</span><span class="d-sm-none">@property.Bathrooms</span>
                                </div>
                                <div class="property-feature">
                                    <i class="fas fa-ruler-combined"></i>
                                    <span><span class="d-none d-sm-inline">@property.SquareMeters m²</span><span class="d-sm-none">@property.SquareMeters m²</span></span>
                                </div>
                            </div>
                            <div class="property-price" style="font-size: 1.25rem;">
                                $@property.PricePerMonth.ToString("N0")
                                <span class="property-price-unit">/month</span>
                            </div>
                            <div class="property-actions">
                                <a asp-action="Details" asp-route-id="@property.Id" class="btn-view-details">
                                    <i class="fas fa-eye"></i>
                                    <span class="d-none d-sm-inline">View Details</span><span class="d-sm-none">View</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="far fa-heart"></i>
            </div>
            <h4 class="fw-bold mb-2" style="font-size: 1.5rem; color: #1f2937;">No Favourite Properties</h4>
            <p class="text-muted mb-4" style="font-size: 1rem;">You haven't saved any properties to your favourites yet.</p>
            <a asp-action="Properties" class="btn-view-details" style="width: auto; padding: 0.75rem 2rem; display: inline-flex;">
                <i class="fas fa-search"></i>
                <span>Browse Properties</span>
            </a>
        </div>
    }
</div>
</div>

